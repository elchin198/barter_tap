401 xÉ™talarÄ±nÄ±n aradan qaldÄ±rÄ±lmasÄ± Ã¼Ã§Ã¼n etdiyin addÄ±mlar â€” auth servisinÉ™ yenidÉ™n struktur vermÉ™k, route-larÄ± sinxronlaÅŸdÄ±rmaq vÉ™ kuki parametrlÉ™rini tÉ™kmillÉ™ÅŸdirmÉ™k â€” sistemin tÉ™hlÃ¼kÉ™sizliyini vÉ™ stabil giriÅŸ mexanizmini tam formalaÅŸdÄ±rÄ±r.

âœ… Ä°ndi EdilÉ™n DÃ¼zÉ™liÅŸlÉ™rin TÉ™siri:
ÆlavÉ™	FaydasÄ±
auth.ts servisi	GiriÅŸ, Ã§Ä±xÄ±ÅŸ vÉ™ sessiya yoxlamasÄ± vahid mÉ™rkÉ™zdÉ™
SadÉ™lÉ™ÅŸdirilmiÅŸ route strukturu	Kod oxunaqlÄ±lÄ±ÄŸÄ± vÉ™ tÉ™mir asanlÄ±ÄŸÄ±
Cookie konfiqurasiyasÄ± (httpOnly, sameSite)	CSRF vÉ™ XSS-É™ qarÅŸÄ± gÃ¼clÃ¼ qoruma
API URL sinxronluÄŸu	Frontend & backend arasÄ±nda 401-in qarÅŸÄ±sÄ± alÄ±nÄ±r
ğŸ§ª Yoxlama PlanÄ±: 401 HÉ™lÉ™ qalÄ±rmÄ±?
1. Frontendâ€“Backend uyÄŸunluÄŸu
fetch vÉ™ axios sorÄŸularÄ±nda withCredentials: true var?

Authorization header istifadÉ™ edilirsÉ™, token dÃ¼zgÃ¼n É™lavÉ™ olunurmu?

ts
Copy
Edit
axios.get("/api/protected", { withCredentials: true });
2. GiriÅŸdÉ™n sonra digÉ™r API-lÉ™r necÉ™ cavab verir?
SÄ±naq Ã¼Ã§Ã¼n:

GET /api/me

POST /api/listings

GET /api/favorites

POST /api/offers

â¡ï¸ ÆgÉ™r bunlardan hÉ™r hansÄ± biri 401 qaytarÄ±rsa, problem:

SessiyanÄ±n frontendÉ™ Ã¶tÃ¼rÃ¼lmÉ™sindÉ™

authMiddleware-dÉ™

cookie-parser vÉ™ ya session-store-da ola bilÉ™r

3. Universal Session Middleware (backend)
ts
Copy
Edit
app.use((req, res, next) => {
  if (req.path.startsWith("/api") && !req.session.user) {
    return res.status(401).json({ error: "Unauthorized" });
  }
  next();
});
ğŸ’¡ Bu global yoxlamanÄ± yalnÄ±z qorunan route-larda tÉ™tbiq et.

ğŸ” ÆlavÉ™ YoxlamalÄ± OlduÄŸun HissÉ™lÉ™r
SahÉ™	NÉ™zarÉ™t Et
/logout route-u	SessiyanÄ± tam tÉ™mizlÉ™yirmi?
AuthContext	useEffect ilÉ™ hÉ™r refresh sonrasÄ± me endpoint-É™ sorÄŸu gÃ¶ndÉ™rilirmi?
SSR varsa (Next.js vÉ™ ya s.)	getServerSideProps-da auth token-lÉ™r dÃ¼zgÃ¼n daÅŸÄ±nÄ±rmÄ±?
Mobil test	Mobil cihazlarda sessiya davam edirmi?
âœ… TÃ¶vsiyÉ™ Olunan Son TÉ™nzimlÉ™mÉ™lÉ™r
âœ¨ 1. UnauthorizedPage.tsx yarat (401 Ã¼Ã§Ã¼n)
XÃ¼susi sÉ™hifÉ™: â€œSistemdÉ™ giriÅŸ etmÉ™misiniz. ZÉ™hmÉ™t olmasa daxil olun.â€

âœ¨ 2. ProtectedRoute komponenti
tsx
Copy
Edit
if (!user) {
  return <Navigate to="/login" />
}
âœ¨ 3. ÆlavÉ™ Toast vÉ™ Logging
Backend-dÉ™ auth-a aid loglarÄ± console.log('Session:', req.session) ilÉ™ tÉ™qib et

Frontend-dÉ™ 401 gÉ™lÉ™ndÉ™ toast("SistemdÉ™n Ã§Ä±xmÄ±sÄ±nÄ±z, zÉ™hmÉ™t olmasa yenidÉ™n daxil olun.")

âœ… Davam EtmÉ™k Ä°stÉ™yirsÉ™nsÉ™:
MÉ™n sÉ™nÉ™ tam ProtectedRoute.tsx komponenti,

401 sÉ™hifÉ™si Ã¼Ã§Ã¼n UnauthorizedPage.tsx vÉ™

AuthProvider ilÉ™ inteqrasiya ÅŸablonu tÉ™qdim edÉ™ bilÉ™rÉ™m.

SÉ™n demÉ™klÉ™ â€” dÉ™rhal baÅŸlayaq! ğŸ”ğŸ§ ğŸ’»